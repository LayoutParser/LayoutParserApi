name: Deploy to Production Server

on:
  push:
    branches:
      - main
      - master
    # Workflow est√° no reposit√≥rio LayoutParserApi, ent√£o s√≥ aciona quando h√° push neste reposit√≥rio
    paths:
      - '**'  # Qualquer mudan√ßa no LayoutParserApi aciona o deploy
  workflow_dispatch: # Permite executar manualmente

jobs:
  deploy:
    runs-on: self-hosted  # ‚úÖ Runner instalado no servidor (172.25.32.42)
    timeout-minutes: 30
    
    steps:
    - name: Checkout LayoutParserApi
      uses: actions/checkout@v4
      with:
        path: LayoutParserApi
    
    - name: Checkout LayoutParserLib
      uses: actions/checkout@v4
      with:
        repository: Elsonc1/LayoutParserLib
        path: LayoutParserLib
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Checkout LayoutParserDecrypt
      uses: actions/checkout@v4
      with:
        repository: Elsonc1/LayoutParserDecrypt
        path: LayoutParserDecrypt
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Checkout LayoutParser (Front-end)
      uses: actions/checkout@v4
      with:
        repository: Elsonc1/LayoutParser
        path: LayoutParser
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '9.0.x'
    
    - name: Setup MSBuild for .NET Framework
      uses: microsoft/setup-msbuild@v1.1
    
    - name: Build LayoutParserLib (.NET Framework 4.8.1)
      run: |
        $WORK_DIR = $PWD.Path
        $LIB_DIR = Join-Path $WORK_DIR "LayoutParserLib"
        $LIB_PROJECT = Join-Path $LIB_DIR "LayoutParserLib.csproj"
        
        Write-Host "üì¶ Compilando LayoutParserLib..."
        Write-Host "üìÇ Diret√≥rio: $LIB_DIR"
        Write-Host "üìÇ Projeto: $LIB_PROJECT"
        
        if (-not (Test-Path $LIB_PROJECT)) {
          Write-Error "‚ùå Projeto n√£o encontrado: $LIB_PROJECT"
          Write-Host "üìã Conte√∫do do diret√≥rio de trabalho:"
          Get-ChildItem -Path $WORK_DIR | Select-Object Name | Format-Table
          if (Test-Path $LIB_DIR) {
            Write-Host "üìã Conte√∫do de LayoutParserLib:"
            Get-ChildItem -Path $LIB_DIR | Select-Object Name | Format-Table
          }
          exit 1
        }
        
        msbuild "$LIB_PROJECT" /p:Configuration=Release /p:Platform=AnyCPU /t:Restore,Build /verbosity:minimal
        
        if ($LASTEXITCODE -ne 0) {
          Write-Error "Falha ao compilar LayoutParserLib"
          exit 1
        }
        
        Write-Host "‚úÖ LayoutParserLib compilado com sucesso"
    
    - name: Build LayoutParserDecrypt (.NET Framework 4.8.1)
      run: |
        $WORK_DIR = $PWD.Path
        $LIB_DIR = Join-Path $WORK_DIR "LayoutParserLib"
        $LIB_DLL = Join-Path $LIB_DIR "bin\Release\LayoutParserLib.dll"
        $DECRYPT_DIR = Join-Path $WORK_DIR "LayoutParserDecrypt"
        $DECRYPT_PROJECT = Join-Path $DECRYPT_DIR "LayoutParserDecrypt.csproj"
        
        Write-Host "üì¶ Compilando LayoutParserDecrypt..."
        Write-Host "üìÇ Diret√≥rio: $DECRYPT_DIR"
        Write-Host "üìÇ Projeto: $DECRYPT_PROJECT"
        
        # Copiar DLL da lib para o diret√≥rio do Decrypt
        if (Test-Path $LIB_DLL) {
          Copy-Item -Path $LIB_DLL -Destination $DECRYPT_DIR -Force
          Write-Host "‚úÖ LayoutParserLib.dll copiado para LayoutParserDecrypt"
        } else {
          Write-Warning "‚ö†Ô∏è LayoutParserLib.dll n√£o encontrado em: $LIB_DLL"
          Write-Host "üìã Verificando se LayoutParserLib foi compilado..."
          if (Test-Path $LIB_DIR) {
            Get-ChildItem -Path $LIB_DIR -Recurse -Filter "*.dll" | Select-Object FullName | Format-Table
          }
        }
        
        if (-not (Test-Path $DECRYPT_PROJECT)) {
          Write-Error "‚ùå Projeto n√£o encontrado: $DECRYPT_PROJECT"
          if (Test-Path $DECRYPT_DIR) {
            Write-Host "üìã Conte√∫do de LayoutParserDecrypt:"
            Get-ChildItem -Path $DECRYPT_DIR | Select-Object Name | Format-Table
          }
          exit 1
        }
        
        msbuild "$DECRYPT_PROJECT" /p:Configuration=Release /p:Platform=AnyCPU /t:Restore,Build /verbosity:minimal
        
        if ($LASTEXITCODE -ne 0) {
          Write-Error "Falha ao compilar LayoutParserDecrypt"
          exit 1
        }
        
        Write-Host "‚úÖ LayoutParserDecrypt compilado com sucesso"
    
    - name: Build LayoutParserApi (.NET Core 9.0)
      run: |
        $WORK_DIR = $PWD.Path
        $API_DIR = Join-Path $WORK_DIR "LayoutParserApi"
        
        Write-Host "üì¶ Compilando LayoutParserApi..."
        Write-Host "üìÇ Diret√≥rio: $API_DIR"
        
        if (-not (Test-Path $API_DIR)) {
          Write-Error "‚ùå Diret√≥rio LayoutParserApi n√£o encontrado: $API_DIR"
          Write-Host "üìã Conte√∫do do diret√≥rio de trabalho:"
          Get-ChildItem -Path $WORK_DIR | Select-Object Name | Format-Table
          exit 1
        }
        
        Push-Location $API_DIR
        
        try {
          dotnet restore
          dotnet build --configuration Release --no-restore
          
          if ($LASTEXITCODE -ne 0) {
            Write-Error "Falha ao compilar LayoutParserApi"
            exit 1
          }
          
          Write-Host "‚úÖ LayoutParserApi compilado com sucesso"
        } finally {
          Pop-Location
        }
    
    - name: Publish LayoutParserApi
      run: |
        $WORK_DIR = $PWD.Path
        $API_DIR = Join-Path $WORK_DIR "LayoutParserApi"
        $PROJECT_PATH = Join-Path $API_DIR "LayoutParserApi.csproj"
        $PUBLISH_OUTPUT = Join-Path $WORK_DIR "publish-api"
        
        Write-Host "üì¶ Publicando LayoutParserApi..."
        Write-Host "üìÇ Projeto: $PROJECT_PATH"
        Write-Host "üìÇ Sa√≠da: $PUBLISH_OUTPUT"
        
        if (-not (Test-Path $PROJECT_PATH)) {
          Write-Error "‚ùå Projeto n√£o encontrado: $PROJECT_PATH"
          exit 1
        }
        
        # Criar diret√≥rio de sa√≠da se n√£o existir
        New-Item -ItemType Directory -Path $PUBLISH_OUTPUT -Force | Out-Null
        
        # Publicar com caminhos absolutos
        dotnet publish "$PROJECT_PATH" --configuration Release --output "$PUBLISH_OUTPUT"
        
        if ($LASTEXITCODE -ne 0) {
          Write-Error "Falha ao publicar LayoutParserApi"
          exit 1
        }
        
        Write-Host "‚úÖ LayoutParserApi publicado com sucesso em: $PUBLISH_OUTPUT"
    
    - name: Create deployment package
      run: |
        $WORK_DIR = $PWD.Path
        Write-Host "üì¶ Criando pacote de deploy..."
        Write-Host "üìÇ Diret√≥rio de trabalho: $WORK_DIR"
        
        # Criar estrutura de deploy
        New-Item -ItemType Directory -Path deploy/api -Force | Out-Null
        New-Item -ItemType Directory -Path deploy/front-end -Force | Out-Null
        
        # Copiar arquivos da API (do publish-api)
        Write-Host "üìã Copiando arquivos da API..."
        $PUBLISH_API_PATH = Join-Path $WORK_DIR "publish-api"
        if (Test-Path $PUBLISH_API_PATH) {
          Copy-Item -Path "$PUBLISH_API_PATH\*" -Destination "deploy/api/" -Recurse -Force
          Write-Host "‚úÖ Arquivos copiados de: $PUBLISH_API_PATH"
        } else {
          Write-Error "‚ùå Diret√≥rio de publica√ß√£o n√£o encontrado: $PUBLISH_API_PATH"
          exit 1
        }
        
        # Copiar arquivos do front-end
        Write-Host "üìã Copiando arquivos do front-end..."
        $FRONTEND_SOURCE = Join-Path $WORK_DIR "LayoutParser\wwwroot"
        if (Test-Path $FRONTEND_SOURCE) {
          Copy-Item -Path "$FRONTEND_SOURCE\*" -Destination "deploy/front-end/" -Recurse -Force
          Write-Host "‚úÖ Arquivos do front-end copiados de: $FRONTEND_SOURCE"
        } else {
          Write-Warning "‚ö†Ô∏è Diret√≥rio do front-end n√£o encontrado: $FRONTEND_SOURCE"
        }
        
        # Copiar LayoutParserDecrypt.exe e DLLs
        Write-Host "üìã Copiando LayoutParserDecrypt e depend√™ncias..."
        $DECRYPT_EXE = Join-Path $WORK_DIR "LayoutParserDecrypt\bin\Release\LayoutParserDecrypt.exe"
        $DECRYPT_DLL = Join-Path $WORK_DIR "LayoutParserDecrypt\bin\Release\LayoutParserLib.dll"
        $LIB_DLL = Join-Path $WORK_DIR "LayoutParserLib\bin\Release\LayoutParserLib.dll"
        
        if (Test-Path $DECRYPT_EXE) {
          Copy-Item -Path $DECRYPT_EXE -Destination "deploy/api/" -Force
          Write-Host "  ‚úÖ LayoutParserDecrypt.exe copiado de: $DECRYPT_EXE"
        } else {
          Write-Warning "  ‚ö†Ô∏è LayoutParserDecrypt.exe n√£o encontrado em: $DECRYPT_EXE"
        }
        
        if (Test-Path $DECRYPT_DLL) {
          Copy-Item -Path $DECRYPT_DLL -Destination "deploy/api/" -Force
          Write-Host "  ‚úÖ LayoutParserLib.dll copiado de: $DECRYPT_DLL"
        } elseif (Test-Path $LIB_DLL) {
          Copy-Item -Path $LIB_DLL -Destination "deploy/api/" -Force
          Write-Host "  ‚úÖ LayoutParserLib.dll copiado de: $LIB_DLL"
        } else {
          Write-Warning "  ‚ö†Ô∏è LayoutParserLib.dll n√£o encontrado em nenhum dos locais"
        }
        
        # Verificar estrutura
        Write-Host "`nüìÇ Estrutura do deploy:"
        Get-ChildItem -Path deploy -Recurse -File | Select-Object FullName | ForEach-Object { Write-Host "  $($_.FullName)" }
        
        Write-Host "`n‚úÖ Pacote de deploy criado com sucesso!"
    
    - name: Deploy to server (local)
      run: |
        $ErrorActionPreference = "Stop"
        $DEPLOY_PATH = "${{ secrets.DEPLOY_PATH }}"
        
        # Validar se DEPLOY_PATH est√° configurado
        if ([string]::IsNullOrWhiteSpace($DEPLOY_PATH)) {
          Write-Error "‚ùå DEPLOY_PATH n√£o est√° configurado! Configure o secret DEPLOY_PATH no GitHub."
          exit 1
        }
        
        # Normalizar caminho (remover aspas se houver)
        $DEPLOY_PATH = $DEPLOY_PATH.Trim('"', '''', ' ')
        
        # Obter caminho absoluto do diret√≥rio de trabalho
        $WORK_DIR = $PWD.Path
        $DEPLOY_SOURCE = Join-Path $WORK_DIR "deploy"
        $DEPLOY_API_SOURCE = Join-Path $DEPLOY_SOURCE "api"
        $DEPLOY_FRONTEND_SOURCE = Join-Path $DEPLOY_SOURCE "front-end"
        
        Write-Host "üöÄ Iniciando deploy no servidor..."
        Write-Host "üìÇ Caminho de deploy (DEPLOY_PATH): $DEPLOY_PATH"
        Write-Host "üìÇ Diret√≥rio de trabalho: $WORK_DIR"
        Write-Host "üì¶ Pacote de deploy: $DEPLOY_SOURCE"
        Write-Host "üì¶ Pacote API: $DEPLOY_API_SOURCE"
        Write-Host "üèÉ Runner: Self-hosted (executando localmente)"
        Write-Host "üåê Servidor: 172.25.32.42"
        
        # Verificar se o pacote de deploy existe
        if (-not (Test-Path $DEPLOY_API_SOURCE)) {
          Write-Error "‚ùå Diret√≥rio de deploy n√£o encontrado: $DEPLOY_API_SOURCE"
          Write-Host "üìã Conte√∫do do diret√≥rio de trabalho:"
          Get-ChildItem -Path $WORK_DIR | Select-Object Name, FullName | Format-Table
          exit 1
        }
        
        Write-Host "‚úÖ Pacote de deploy encontrado em: $DEPLOY_SOURCE"
        Write-Host "üìã Arquivos no pacote API:"
        Get-ChildItem -Path $DEPLOY_API_SOURCE -File | Select-Object Name | Format-Table
        
        # Criar diret√≥rios se n√£o existirem
        Write-Host "üìÅ Criando diret√≥rios de destino..."
        $DEPLOY_API_PATH = Join-Path $DEPLOY_PATH "api"
        $DEPLOY_FRONTEND_PATH = Join-Path $DEPLOY_PATH "front-end"
        $DEPLOY_LOGS_PATH = Join-Path $DEPLOY_API_PATH "Logs"
        $DEPLOY_BACKUPS_PATH = Join-Path $DEPLOY_PATH "backups"
        
        Write-Host "üìÅ Diret√≥rios de destino:"
        Write-Host "   API: $DEPLOY_API_PATH"
        Write-Host "   Front-end: $DEPLOY_FRONTEND_PATH"
        Write-Host "   Logs: $DEPLOY_LOGS_PATH"
        Write-Host "   Backups: $DEPLOY_BACKUPS_PATH"
        
        # Criar diret√≥rios com verifica√ß√£o
        if (-not (Test-Path $DEPLOY_PATH)) {
          Write-Host "üìÅ Criando diret√≥rio base: $DEPLOY_PATH"
          New-Item -ItemType Directory -Path $DEPLOY_PATH -Force | Out-Null
        }
        
        if (-not (Test-Path $DEPLOY_API_PATH)) {
          Write-Host "üìÅ Criando diret√≥rio API: $DEPLOY_API_PATH"
          New-Item -ItemType Directory -Path $DEPLOY_API_PATH -Force | Out-Null
        }
        
        if (-not (Test-Path $DEPLOY_FRONTEND_PATH)) {
          Write-Host "üìÅ Criando diret√≥rio Front-end: $DEPLOY_FRONTEND_PATH"
          New-Item -ItemType Directory -Path $DEPLOY_FRONTEND_PATH -Force | Out-Null
        }
        
        if (-not (Test-Path $DEPLOY_LOGS_PATH)) {
          Write-Host "üìÅ Criando diret√≥rio Logs: $DEPLOY_LOGS_PATH"
          New-Item -ItemType Directory -Path $DEPLOY_LOGS_PATH -Force | Out-Null
        }
        
        if (-not (Test-Path $DEPLOY_BACKUPS_PATH)) {
          Write-Host "üìÅ Criando diret√≥rio Backups: $DEPLOY_BACKUPS_PATH"
          New-Item -ItemType Directory -Path $DEPLOY_BACKUPS_PATH -Force | Out-Null
        }
        
        Write-Host "‚úÖ Diret√≥rios criados/verificados"
        
        # Verificar se os diret√≥rios foram criados
        if (-not (Test-Path $DEPLOY_API_PATH)) {
          Write-Error "‚ùå Falha ao criar diret√≥rio API: $DEPLOY_API_PATH"
          exit 1
        }
        
        # Backup do appsettings.json se existir
        $APP_SETTINGS_PATH = Join-Path $DEPLOY_API_PATH "appsettings.json"
        Write-Host "üíæ Verificando appsettings.json em: $APP_SETTINGS_PATH"
        if (Test-Path $APP_SETTINGS_PATH) {
          $backupName = "appsettings-$(Get-Date -Format 'yyyyMMdd-HHmmss').json"
          $backupPath = Join-Path $DEPLOY_BACKUPS_PATH $backupName
          Write-Host "üíæ Fazendo backup do appsettings.json: $backupName"
          Write-Host "   Origem: $APP_SETTINGS_PATH"
          Write-Host "   Destino: $backupPath"
          
          # Verificar se diret√≥rio de backup existe
          if (-not (Test-Path $DEPLOY_BACKUPS_PATH)) {
            Write-Host "‚ö†Ô∏è Diret√≥rio de backup n√£o existe, criando: $DEPLOY_BACKUPS_PATH"
            New-Item -ItemType Directory -Path $DEPLOY_BACKUPS_PATH -Force | Out-Null
          }
          
          Copy-Item -Path $APP_SETTINGS_PATH -Destination $backupPath -Force
          
          if (Test-Path $backupPath) {
            $backupInfo = Get-Item $backupPath
            Write-Host "‚úÖ Backup criado com sucesso em: $backupPath"
            Write-Host "   Tamanho: $([math]::Round($backupInfo.Length / 1KB, 2)) KB"
          } else {
            Write-Warning "‚ö†Ô∏è Backup n√£o foi criado! Verifique permiss√µes."
          }
        } else {
          Write-Host "‚ÑπÔ∏è appsettings.json n√£o encontrado em: $APP_SETTINGS_PATH (primeiro deploy?)"
        }
        
        # Parar servi√ßo Windows se existir
        $serviceName = "LayoutParserApi"
        if (Get-Service -Name $serviceName -ErrorAction SilentlyContinue) {
          Write-Host "‚è∏Ô∏è Parando servi√ßo $serviceName..."
          Stop-Service -Name $serviceName -Force -ErrorAction SilentlyContinue
          Start-Sleep -Seconds 3
          Write-Host "‚úÖ Servi√ßo parado"
        } else {
          Write-Host "‚ÑπÔ∏è Servi√ßo $serviceName n√£o encontrado (pode n√£o estar instalado como servi√ßo)"
        }
        
        # Copiar arquivos da API (manter appsettings.json se j√° existir)
        Write-Host "üìã Copiando arquivos da API..."
        Write-Host "   Origem: $DEPLOY_API_SOURCE"
        Write-Host "   Destino: $DEPLOY_API_PATH"
        
        # Verificar e mostrar caminhos absolutos
        Write-Host "üîç Verificando caminhos..."
        Write-Host "   DEPLOY_PATH (raw): $DEPLOY_PATH"
        Write-Host "   DEPLOY_API_PATH (resolvido): $DEPLOY_API_PATH"
        Write-Host "   DEPLOY_API_PATH existe: $(Test-Path $DEPLOY_API_PATH)"
        
        if (-not (Test-Path $DEPLOY_API_SOURCE)) {
          Write-Error "‚ùå Diret√≥rio de origem n√£o encontrado: $DEPLOY_API_SOURCE"
          Write-Host "üìã Conte√∫do do diret√≥rio de trabalho:"
          Get-ChildItem -Path $WORK_DIR | Select-Object Name | Format-Table
          exit 1
        }
        
        if (-not (Test-Path $DEPLOY_API_PATH)) {
          Write-Error "‚ùå Diret√≥rio de destino n√£o encontrado: $DEPLOY_API_PATH"
          Write-Host "üìã Tentando criar novamente..."
          New-Item -ItemType Directory -Path $DEPLOY_API_PATH -Force | Out-Null
          if (-not (Test-Path $DEPLOY_API_PATH)) {
            Write-Error "‚ùå Falha ao criar diret√≥rio de destino. Verifique permiss√µes."
            Write-Host "üí° Execute como Administrador:"
            Write-Host "   icacls `"$DEPLOY_PATH`" /grant `"BRNDDAPPBLD01\appbld:(OI)(CI)F`" /T"
            exit 1
          }
        }
        
        $apiFiles = Get-ChildItem -Path $DEPLOY_API_SOURCE -Exclude "appsettings.json" -Recurse -File
        Write-Host "üìã Encontrados $($apiFiles.Count) arquivos para copiar"
        
        if ($apiFiles.Count -eq 0) {
          Write-Warning "‚ö†Ô∏è Nenhum arquivo encontrado em: $DEPLOY_API_SOURCE"
          Write-Host "üìã Conte√∫do do diret√≥rio de origem:"
          Get-ChildItem -Path $DEPLOY_API_SOURCE -Recurse | Select-Object FullName | Format-Table
        }
        
        $copiedCount = 0
        $errorCount = 0
        foreach ($file in $apiFiles) {
          try {
            $relativePath = $file.FullName.Substring($DEPLOY_API_SOURCE.Length + 1)
            $destPath = Join-Path $DEPLOY_API_PATH $relativePath
            $destDir = Split-Path $destPath -Parent
            
            if (-not (Test-Path $destDir)) {
              New-Item -ItemType Directory -Path $destDir -Force | Out-Null
            }
            
            Copy-Item -Path $file.FullName -Destination $destPath -Force -ErrorAction Stop
            $copiedCount++
            
            if ($copiedCount % 10 -eq 0) {
              Write-Host "   Copiados $copiedCount / $($apiFiles.Count) arquivos..."
            }
          } catch {
            $errorCount++
            Write-Warning "‚ö†Ô∏è Erro ao copiar $($file.Name): $($_.Exception.Message)"
          }
        }
        
        Write-Host "‚úÖ Arquivos da API copiados ($copiedCount arquivos, $errorCount erros)"
        
        # Verificar se os arquivos foram copiados
        Write-Host "üîç Verificando arquivos no destino: $DEPLOY_API_PATH"
        if (Test-Path $DEPLOY_API_PATH) {
          $copiedFiles = Get-ChildItem -Path $DEPLOY_API_PATH -File -ErrorAction SilentlyContinue
          Write-Host "üìã Arquivos no destino: $($copiedFiles.Count) arquivos"
          if ($copiedFiles.Count -gt 0) {
            Write-Host "   Primeiros arquivos:"
            $copiedFiles | Select-Object -First 10 Name, Length, LastWriteTime | Format-Table
          } else {
            Write-Warning "‚ö†Ô∏è Nenhum arquivo foi copiado para $DEPLOY_API_PATH"
            Write-Host "üìã Listando conte√∫do do diret√≥rio:"
            Get-ChildItem -Path $DEPLOY_API_PATH -ErrorAction SilentlyContinue | Select-Object Name, FullName | Format-Table
          }
        } else {
          Write-Error "‚ùå Diret√≥rio de destino n√£o existe ap√≥s tentativa de c√≥pia: $DEPLOY_API_PATH"
        }
        
        # Copiar arquivos do front-end
        Write-Host "üìã Copiando arquivos do front-end de $DEPLOY_FRONTEND_SOURCE para $DEPLOY_FRONTEND_PATH..."
        if (Test-Path $DEPLOY_FRONTEND_SOURCE) {
          $frontendFiles = Get-ChildItem -Path $DEPLOY_FRONTEND_SOURCE -Recurse
          foreach ($file in $frontendFiles) {
            $relativePath = $file.FullName.Substring($DEPLOY_FRONTEND_SOURCE.Length + 1)
            $destPath = Join-Path $DEPLOY_FRONTEND_PATH $relativePath
            $destDir = Split-Path $destPath -Parent
            if (-not (Test-Path $destDir)) {
              New-Item -ItemType Directory -Path $destDir -Force | Out-Null
            }
            Copy-Item -Path $file.FullName -Destination $destPath -Force
          }
          Write-Host "‚úÖ Arquivos do front-end copiados ($($frontendFiles.Count) arquivos)"
        } else {
          Write-Warning "‚ö†Ô∏è Diret√≥rio de front-end n√£o encontrado: $DEPLOY_FRONTEND_SOURCE"
        }
        
        # Verificar se LayoutParserDecrypt.exe foi copiado
        $decryptExePath = Join-Path $DEPLOY_API_PATH "LayoutParserDecrypt.exe"
        if (Test-Path $decryptExePath) {
          Write-Host "‚úÖ LayoutParserDecrypt.exe encontrado em: $decryptExePath"
        } else {
          Write-Warning "‚ö†Ô∏è LayoutParserDecrypt.exe n√£o encontrado em: $decryptExePath"
        }
        
        # Verificar se LayoutParserLib.dll foi copiado
        $libDllPath = Join-Path $DEPLOY_API_PATH "LayoutParserLib.dll"
        if (Test-Path $libDllPath) {
          Write-Host "‚úÖ LayoutParserLib.dll encontrado em: $libDllPath"
        } else {
          Write-Warning "‚ö†Ô∏è LayoutParserLib.dll n√£o encontrado em: $libDllPath"
        }
        
        # Verificar se LayoutParserApi.dll foi copiado (Release)
        $apiDllPath = Join-Path $DEPLOY_API_PATH "LayoutParserApi.dll"
        if (Test-Path $apiDllPath) {
          $dllInfo = Get-Item $apiDllPath
          Write-Host "‚úÖ LayoutParserApi.dll encontrado em: $apiDllPath"
          Write-Host "   üìÖ Data de modifica√ß√£o: $($dllInfo.LastWriteTime)"
          Write-Host "   üì¶ Tamanho: $([math]::Round($dllInfo.Length / 1KB, 2)) KB"
        } else {
          Write-Warning "‚ö†Ô∏è LayoutParserApi.dll n√£o encontrado em: $apiDllPath"
        }
        
        # Reiniciar servi√ßo Windows se existir
        if (Get-Service -Name $serviceName -ErrorAction SilentlyContinue) {
          Write-Host "‚ñ∂Ô∏è Reiniciando servi√ßo $serviceName..."
          Start-Service -Name $serviceName -ErrorAction SilentlyContinue
          Start-Sleep -Seconds 2
          
          $service = Get-Service -Name $serviceName
          if ($service.Status -eq 'Running') {
            Write-Host "‚úÖ Servi√ßo $serviceName est√° em execu√ß√£o"
          } else {
            Write-Warning "‚ö†Ô∏è Servi√ßo $serviceName n√£o est√° em execu√ß√£o (Status: $($service.Status))"
          }
        } else {
          Write-Host "‚ÑπÔ∏è Servi√ßo $serviceName n√£o encontrado. Execute manualmente:"
          Write-Host "   cd $DEPLOY_API_PATH"
          Write-Host "   dotnet LayoutParserApi.dll"
        }
        
        # Validar deploy
        Write-Host "`n‚úÖ Deploy conclu√≠do com sucesso!"
        Write-Host "üìç API: $DEPLOY_API_PATH"
        Write-Host "üìç Front-end: $DEPLOY_FRONTEND_PATH"
        Write-Host "üìç Logs: $DEPLOY_LOGS_PATH"
        Write-Host "üìç Backups: $DEPLOY_BACKUPS_PATH"
        Write-Host "üèÉ Runner: Self-hosted (execu√ß√£o local)"
