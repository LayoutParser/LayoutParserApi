<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <title>Parser de Layout Posicional + IA Analyzer</title>
  <link rel="stylesheet" href="style.css?v=2.0">
  <style>
    /* FORÃ‡A ABAS LADO A LADO - PRIORIDADE MÃXIMA */
    div.sub-tabs {
      display: -webkit-box !important;
      display: -ms-flexbox !important;
      display: -webkit-flex !important;
      display: flex !important;
      -webkit-flex-direction: row !important;
      -ms-flex-direction: row !important;
      flex-direction: row !important;
      gap: 10px !important;
      -webkit-box-pack: center !important;
      -ms-flex-pack: center !important;
      -webkit-justify-content: center !important;
      justify-content: center !important;
      -webkit-flex-wrap: nowrap !important;
      -ms-flex-wrap: nowrap !important;
      flex-wrap: nowrap !important;
      width: 100% !important;
      max-width: 600px !important;
      margin: 20px auto 30px auto !important;
      background: white !important;
      padding: 10px !important;
      border: 2px solid #28a745 !important;
      border-radius: 10px !important;
    }
    
    button.sub-tab-button {
      -webkit-box-flex: 1 !important;
      -ms-flex: 1 !important;
      -webkit-flex: 1 !important;
      flex: 1 !important;
      display: -webkit-inline-box !important;
      display: -ms-inline-flexbox !important;
      display: -webkit-inline-flex !important;
      display: inline-flex !important;
      -webkit-box-align: center !important;
      -ms-flex-align: center !important;
      -webkit-align-items: center !important;
      align-items: center !important;
      -webkit-box-pack: center !important;
      -ms-flex-pack: center !important;
      -webkit-justify-content: center !important;
      justify-content: center !important;
      padding: 14px 20px !important;
      border-radius: 8px !important;
      border: none !important;
      cursor: pointer !important;
      font-size: 14px !important;
      font-weight: 600 !important;
      color: #666 !important;
      background: #f8f9fa !important;
      transition: all 0.3s ease !important;
      margin: 0 !important;
      min-width: 0 !important;
      width: auto !important;
      float: none !important;
      position: relative !important;
      clear: none !important;
    }
    
    button.sub-tab-button.active {
      color: white !important;
      background: linear-gradient(135deg, #28a745, #1e7e34) !important;
      box-shadow: 0 3px 6px rgba(40, 167, 69, 0.3) !important;
    }
    
    button.sub-tab-button:hover:not(.active) {
      background: #e9ecef !important;
      color: #28a745 !important;
    }

    .search-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

        .search-btn:hover {
          transform: translateY(-2px);
          box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .refresh-btn {
          background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
          color: white;
          border: none;
          padding: 12px 24px;
          border-radius: 8px;
          cursor: pointer;
          font-size: 14px;
          font-weight: 600;
          transition: all 0.3s ease;
          box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .refresh-btn:hover {
          transform: translateY(-2px);
          box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

    .search-results {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
    }

    .search-results h4 {
      margin: 0 0 10px 0;
      color: #495057;
    }

    .search-results select {
      border: 1px solid #ced4da;
      border-radius: 4px;
      padding: 8px;
      font-size: 14px;
    }

    .load-btn {
      background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      transition: all 0.3s ease;
      margin-top: 10px;
    }

    .load-btn:disabled {
      background: #6c757d;
      cursor: not-allowed;
      opacity: 0.6;
    }

    .load-btn:not(:disabled):hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
    }
  </style>
</head>

<body>
  <!-- BARRA DE NAVEGAÃ‡ÃƒO COM ABAS -->
  <div class="main-tabs">
    <button class="main-tab-button active" onclick="switchMainTab('upload')">
      ğŸ“¤ Upload & Processamento
    </button>
    <button class="main-tab-button" onclick="switchMainTab('analysis')">
      ğŸ“Š AnÃ¡lise & Estrutura
    </button>
    <button class="main-tab-button" onclick="switchMainTab('console')">
      ğŸ“Ÿ Console de Processamento
    </button>
  </div>

  <div class="container">
    <!-- ABA 1: UPLOAD & PROCESSAMENTO -->
    <div id="uploadTab" class="main-tab-content active">
      <div class="pane full-width">
        <!-- SUB-ABAS: UPLOAD OU GERAÃ‡ÃƒO -->
        <div class="sub-tabs" style="display: flex !important; flex-direction: row !important; gap: 10px !important; justify-content: center !important; max-width: 600px !important; margin: 0 auto 30px auto !important;">
          <button class="sub-tab-button active" onclick="switchSubTab('upload')" style="flex: 1 !important; padding: 14px 20px !important; border-radius: 8px !important;">
            ğŸ“¤ Upload e Processamento
          </button>
          <button class="sub-tab-button" onclick="switchSubTab('generation')" style="flex: 1 !important; padding: 14px 20px !important; border-radius: 8px !important;">
            âš¡ GeraÃ§Ã£o de Dados
          </button>
        </div>

        <!-- CONTEÃšDO DA SUB-ABA: UPLOAD E PROCESSAMENTO -->
        <div id="uploadSubTab" class="sub-tab-content active">
          <div class="upload-section">
            <form id="uploadForm">
              <div class="input-group">
                <button type="button" onclick="searchLayoutsFromDatabaseForUpload()" class="search-btn">
                  ğŸ” Buscar Layouts do Banco
                </button>
              </div>

              <div id="layoutSearchResultsUpload" class="search-results" style="display: none;">
                <h4>ğŸ“‹ Layouts Encontrados:</h4>
                <select id="layoutSelectUpload" size="5" style="width: 100%; margin: 10px 0;">
                  <option value="">Selecione um layout...</option>
                </select>
                <button type="button" onclick="loadSelectedLayoutForUpload()" class="load-btn" disabled>
                  âœ… Selecionar Layout para Processamento
                </button>
              </div>

              <div class="file-input-group">
                <label>ğŸ“ Documento TXT Posicional:
                  <input type="file" id="txtFile" name="txtFile" accept=".txt,.mqseries" required>
                </label>
              </div>

              <div class="button-group">
                <button type="submit" class="process-btn">
                  ğŸ” Processar & Analisar Documento
                </button>
              </div>
            </form>

            <div id="uploadStatus" class="status-message"></div>
          </div>

          <!-- CONSOLE RÃPIDO DE STATUS -->
          <div class="quick-console">
            <h4>ğŸ“‹ Status do Processamento</h4>
            <div id="quickStatus" class="console-output">
              â³ Aguardando processamento...
            </div>
          </div>
        </div>

        <!-- CONTEÃšDO DA SUB-ABA: GERAÃ‡ÃƒO DE DADOS -->
        <div id="generationSubTab" class="sub-tab-content">
          <div class="generation-section">
            <div class="input-group">
              <button type="button" onclick="searchLayoutsFromDatabase()" class="search-btn">
                ğŸ” Buscar Layouts do Banco
              </button>
            </div>

            <div class="input-group">
              <button type="button" onclick="refreshCacheFromDatabase()" class="refresh-btn">
                ğŸ”„ Atualizar Cache do Banco
              </button>
            </div>

            <div id="layoutSearchResults" class="search-results" style="display: none;">
              <h4>ğŸ“‹ Layouts Encontrados:</h4>
              <select id="layoutSelect" size="5" style="width: 100%; margin: 10px 0;">
                <option value="">Selecione um layout...</option>
              </select>
              <button type="button" onclick="loadSelectedLayout()" class="load-btn" disabled>
                âœ… Selecionar Layout para GeraÃ§Ã£o
              </button>
            </div>

            <div class="input-group">
              <label>ğŸ“ NÃºmero de Arquivos no ZIP:
                <input type="number" id="numberOfFiles" value="5" min="1" max="100">
              </label>
            </div>

            <div class="button-group">
              <button type="button" onclick="generateAndDownloadFiles()" class="generator-btn">
                ğŸ“¦ Gerar e Baixar ZIP
              </button>
            </div>

            <div id="generationStatus" class="status-message"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ABA 2: ANÃLISE & ESTRUTURA -->
    <div id="analysisTab" class="main-tab-content">
      <div class="analysis-container">
        <!-- APENAS 2 ABAS INTERNAS -->
        <div class="internal-tabs">
          <button class="internal-tab-button active" onclick="switchInternalTab('structure')">
            ğŸ—ï¸ Estrutura do Layout
          </button>
          <button class="internal-tab-button" onclick="switchInternalTab('content')">
            ğŸ“„ ConteÃºdo do Arquivo
          </button>
        </div>

        <!-- CONTEÃšDO DAS ABAS - AMBAS VISÃVEIS SEMPRE -->
        <div class="internal-tab-content active" id="structureTabInternal">
          <!-- ESTRUTURA DO LAYOUT (ESQUERDA) -->
          <div class="pane full-height">
            <div id="summary"></div>

            <div id="analysisSummary" style="display: none; margin: 10px 0;"></div>

            <div class="search-box">
              <input type="text" id="searchField" placeholder="ğŸ” Buscar campo...">
            </div>

            <div class="tree-controls" style="display: none;">
              <!-- Controles removidos conforme solicitado -->
            </div>

            <ul id="layoutTree"></ul>
          </div>

          <!-- CONTEÃšDO DO ARQUIVO (DIREITA) -->
          <div class="pane full-height">
            <div class="text-info">
              <div id="textStats"></div>

              <div class="content-controls">
                <button onclick="clearFieldSelection()">ğŸ—‘ï¸ Limpar SeleÃ§Ã£o</button>
              </div>

              <!-- VISUALIZADOR DE CAMPOS ESTILO VIEWER -->
              <div id="fieldViewer" class="field-viewer-container">
                <div class="viewer-header">
                  <span id="selectedLineName">Selecione uma linha na estrutura â†’</span>
                </div>
                <div id="fieldDisplay" class="field-display">
                  <!-- Os campos serÃ£o renderizados aqui dinamicamente -->
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ABA INTERNA 2: CONTEÃšDO DO ARQUIVO -->
        <div class="internal-tab-content" id="contentTabInternal">
          <!-- MENSAGEM INICIAL (quando nÃ£o hÃ¡ dados processados) -->
          <div id="viewerPlaceholder" class="viewer-placeholder">
            <div style="text-align: center; padding: 60px 20px; color: #999;">
              <div style="font-size: 64px; margin-bottom: 20px;">ğŸ“„</div>
              <h3 style="color: #666; margin: 0 0 10px 0;">Nenhum documento processado</h3>
              <p style="font-size: 14px; margin: 0;">
                FaÃ§a o upload e processamento de um documento na aba "Upload & Processamento" para visualizÃ¡-lo aqui.
              </p>
            </div>
          </div>

          <!-- VISUALIZADOR INTEGRADO (aparece apÃ³s processamento) -->
          <div id="integratedViewer" class="integrated-viewer" style="display: none;">
            <!-- Barra de controles -->
            <div class="viewer-controls">
              <div class="viewer-controls-left">
                <h3 style="margin: 0; color: #333; font-size: 16px;">ğŸ“„ Visualizador de ConteÃºdo</h3>
                <span id="viewerDocInfo" style="font-size: 11px; color: #666; margin-left: 15px;"></span>
              </div>
              <div class="viewer-controls-right">
                <button onclick="toggleViewerProperties()" class="viewer-btn">
                  <span id="propertiesBtnIcon">ğŸ‘ï¸</span> Propriedades
                </button>
                <button onclick="exportViewerHTML()" class="viewer-btn">ğŸ’¾ Exportar HTML</button>
                <button onclick="switchInternalTab('structure')" class="viewer-btn viewer-btn-back">
                  â† Voltar para Estrutura
                </button>
              </div>
            </div>

            <!-- Container principal com split -->
            <div class="viewer-container-split">
              <!-- Ãrea de visualizaÃ§Ã£o do documento -->
              <div id="viewerDocumentArea" class="viewer-document-area">
                <table class="viewer-table">
                  <tbody id="viewerDocumentBody"></tbody>
                </table>
              </div>

              <!-- Painel de propriedades lateral -->
              <div id="viewerPropertiesPanel" class="viewer-properties-panel">
                <div class="viewer-properties-header">
                  <h4 style="margin: 0; font-size: 14px;">ğŸ“‹ Propriedades do Campo</h4>
                  <button onclick="closeViewerProperties()" style="background: none; border: none; cursor: pointer; font-size: 18px; color: #999;">Ã—</button>
                </div>
                <div id="viewerPropertiesContent" class="viewer-properties-content">
                  <p style="color: #999; font-style: italic; text-align: center; padding: 40px 20px;">
                    Clique em um campo para ver suas propriedades
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ABA 3: CONSOLE DE PROCESSAMENTO -->
    <div id="consoleTab" class="main-tab-content">
      <div class="pane full-width">
        <h3>ğŸ“Ÿ Console de Processamento</h3>

        <div class="console-header">
          <button onclick="clearConsole()">ğŸ—‘ï¸ Limpar Console</button>
          <button onclick="exportConsole()">ğŸ“¤ Exportar Log</button>
          <span class="console-info" id="consoleInfo">0 mensagens</span>
        </div>

        <div id="processingConsole" class="console-output">
          <div class="console-message info">
            <span class="timestamp">[00:00:00]</span>
            âœ… Sistema inicializado. Aguardando processamento...
          </div>
        </div>

        <!-- ESTATÃSTICAS DO PROCESSAMENTO -->
        <div class="processing-stats">
          <div class="stat-card">
            <span class="stat-number" id="statTotalFields">0</span>
            <span class="stat-label">Campos Total</span>
          </div>
          <div class="stat-card">
            <span class="stat-number" id="statValidFields">0</span>
            <span class="stat-label">âœ… VÃ¡lidos</span>
          </div>
          <div class="stat-card">
            <span class="stat-number" id="statWarningFields">0</span>
            <span class="stat-label">âš  Alertas</span>
          </div>
          <div class="stat-card">
            <span class="stat-number" id="statErrorFields">0</span>
            <span class="stat-label">âŒ Erros</span>
          </div>
          <div class="stat-card score">
            <span class="stat-number" id="statCompliance">0%</span>
            <span class="stat-label">ğŸ“Š Compliance</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- SCRIPTS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="analyzer.js?v=2.0"></script>
  <script src="main.js?v=2.0"></script>
</body>

</html>